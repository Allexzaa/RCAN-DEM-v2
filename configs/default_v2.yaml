# DEM-SR Model v2 - Default Configuration
# ==========================================

# Model Architecture
model:
  type: "rcan_v2"           # rcan_v2 or rcan_v2_light
  scale: 3                  # Upscaling factor (30m -> 10m)
  n_resgroups: 10           # Number of residual groups
  n_resblocks: 20           # Number of RCAB blocks per group
  n_feats: 64               # Number of feature channels
  reduction: 16             # Channel attention reduction ratio
  dropout: 0.1              # Spatial dropout rate
  use_spatial_attention: false  # Enable spatial attention
  use_multiscale: false     # Enable multi-scale convolutions

# Loss Function
loss:
  mode: "fixed"             # "fixed" or "adaptive"
  # Core loss weights
  w_elevation: 1.0
  w_gradient: 0.5
  w_curvature: 0.2
  # New loss components
  w_spectral: 0.1           # Spectral/frequency loss
  w_edge: 0.2               # Edge-aware loss
  w_multiscale: 0.0         # Multi-scale loss (disabled by default)
  w_complexity: 0.1         # Terrain complexity weighting
  # Component toggles
  use_spectral: true
  use_edge: true
  use_multiscale: false
  use_complexity: true
  # Component parameters
  spectral_weight_high: 0.5
  edge_weight: 2.0
  complexity_weight: 2.0

# Training
training:
  epochs: 200
  batch_size: 4             # 4-8 for M3 Ultra
  accumulation_steps: 4     # Effective batch = 16
  
  # Optimizer
  optimizer: "adamw"        # "adam" or "adamw"
  lr: 1.0e-4                # Initial learning rate
  lr_min: 1.0e-6            # Minimum learning rate
  weight_decay: 0.01        # Weight decay (for AdamW)
  
  # Learning rate schedule
  scheduler: "cosine"       # "cosine", "step", or "warmup_cosine"
  warmup_epochs: 5          # Warmup period (0 to disable)
  
  # Early stopping
  early_stopping: true
  patience: 30              # Epochs without improvement
  min_delta: 1.0e-4         # Minimum improvement threshold
  
  # Gradient clipping
  clip_grad_norm: 1.0       # Max gradient norm
  
  # Checkpointing
  save_every: 10            # Save checkpoint every N epochs
  log_every: 10             # Log metrics every N batches

# Data Augmentation
augmentation:
  mode: "full"              # "full", "basic", or "none"
  # Flip/rotation (basic)
  use_flip: true
  use_rotation: true
  # Enhanced augmentation (full)
  use_noise: true
  noise_std: 0.02           # Gaussian noise std
  noise_prob: 0.5
  use_shift: true
  shift_range: 0.1          # Elevation shift range
  shift_prob: 0.5
  use_scale: true
  scale_range: [0.9, 1.1]   # Scale jitter range
  scale_prob: 0.3

# DataLoader
dataloader:
  num_workers: 4
  pin_memory: false         # False for MPS
  persistent_workers: true

# Device
device: "mps"               # "mps", "cuda", or "cpu"
seed: 42

# Inference
inference:
  use_tta: true             # Test-time augmentation
  tta_rotations: [0, 90, 180, 270]
  tta_flips: false
  tile_size: 256
  overlap: 32
  norm_mode: "global"       # "global" or "per_tile"
